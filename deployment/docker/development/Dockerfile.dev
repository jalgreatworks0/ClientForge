FROM node:22-alpine

# OCI standard labels for metadata
LABEL org.opencontainers.image.source="https://github.com/jalgreatworks0/ClientForge"
LABEL org.opencontainers.image.description="ClientForge CRM backend (development)"
LABEL org.opencontainers.image.licenses="MIT"
LABEL org.opencontainers.image.title="ClientForge CRM Backend"
LABEL org.opencontainers.image.vendor="ClientForge"

WORKDIR /app

# system deps
RUN apk add --no-cache tini curl

ENTRYPOINT ["/sbin/tini","--"]

# copy only manifests to leverage docker layer cache
COPY package.json package-lock.json* ./

# install dependencies
RUN npm ci || true

# back to repo root and copy source
COPY . .

# logs directory for promtail file scraping
RUN mkdir -p /app/logs
VOLUME ["/app/logs"]

# Change to backend directory for path resolution
WORKDIR /app/backend

ENV NODE_ENV=development
ENV PORT=3000
EXPOSE 3000

# Use dev script with ts-node-dev for development
CMD ["npm","run","--prefix","/app","dev:backend"]
